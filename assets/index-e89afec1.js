import{r as f,a as Pe,b as W,c as he,j as y}from"./index-e0a0e62b.js";import{B as _e}from"./index-41216d4c.js";import{c as ze}from"./config-component-props-c0788442.js";import{u as re}from"./use-creation-bef55742.js";import{u as We}from"./use-get-state-2ef12360.js";import{u as pe}from"./use-merged-prop-ref-3afcd252.js";import{u as de}from"./use-update-effect-7c97adfc.js";import{I as je}from"./index-328d196d.js";import{u as oe}from"./index-c3c5951b.js";import{u as qe}from"./use-on-popup-open-3848a53c.js";import{g as Y}from"./detect-9e279ab2.js";import{s as Le,a as Ue}from"./scroll-a0e7f6b9.js";import{c as Ge,a as Je}from"./format-73c0cb3b.js";import{n as U,r as Ke,i as me}from"./misc-276e45ca.js";import{d as Qe}from"./raf-e95fb200.js";const Xe=t=>{f.useEffect(()=>{t()},[])},Ze=Xe,C=Pe("fnx-calendar");function G(t,e){const n=t.getFullYear(),g=e.getFullYear();if(n===g){const r=t.getMonth(),l=e.getMonth();return r===l?0:r>l?1:-1}return n>g?1:-1}function x(t,e){const n=G(t,e);if(n===0){const g=t.getDate(),r=e.getDate();return g===r?0:g>r?1:-1}return n}function A(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}const et=t=>new Date(t),ye=t=>J(t,-1),De=t=>J(t,1),tt=()=>{const t=new Date;return t.setHours(0,0,0,0),t};function J(t,e){const n=et(t);return n.setDate(n.getDate()+e),n}function Ce(t,e){const n=t.getTime();return(e.getTime()-n)/(1e3*60*60*24)+1}const Me=f.forwardRef((t,e)=>{const{color:n,dayHeight:g,date:r,content:l,type:c,topInfo:h,bottomInfo:i,style:u,className:p,onClick:N,...S}=t,$=()=>{const I={height:g};if(n)switch(c){case"selected":case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":I.background=n;break;case"middle":I.color=n;break}return{...I,...u}};return W("div",{className:he(C("day",c),p),...S,onClick:c==="disabled"?U:N,style:$(),ref:e,children:[h&&y("div",{className:C("top-info"),children:h}),l||r.getDate(),i&&y("div",{className:C("bottom-info"),children:i})]})});Me.displayName="CalendarDay";const Re=Me;function be(){const t=oe("calendar");return f.useCallback(e=>Ke(t.monthTitle,{year:e.getFullYear(),month:e.getMonth()+1}),[t.monthTitle])}const we=f.forwardRef((t,e)=>{const n=oe("calendar"),{color:g,month:r,firstDayOfWeek:l,dayHeight:c,mode:h,value:i,slots:u,minDate:p,maxDate:N,onClickDay:S,rangeAllowSameDay:$}=t,I=f.useRef(null),H=f.useRef(0),T=f.useRef(null),O=pe(u),v=be(),P=f.useCallback(o=>{const m=O.current.subTitle!==!1?I.current:T.current;if(!m)return;const D=m.getBoundingClientRect().top-o.getBoundingClientRect().top+o.scrollTop;Le(o,D)},[O]);f.useImperativeHandle(e,()=>({element:T.current,getHeight:()=>H.current,scrollIntoView:P}),[P]);const V=f.useMemo(()=>{let o=r.getDay();return l&&(o=(o+7-l)%7),o},[l,r]),j=f.useMemo(()=>new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),[r]),Q=o=>{const[m,D]=i;if(!m)return"normal";const M=x(o,m);if(!D)return M===0?"start":"normal";const w=x(o,D);return $&&M===0&&w===0?"start-end":M===0?"start":w===0?"end":M>0&&w<0?"middle":"normal"},X=o=>{const m=D=>i.findIndex(M=>x(M,D)===0)>=0;if(m(o)){const D=ye(o),M=De(o),w=m(D),B=m(M);return w&&B?"multiple-middle":w?"end":B?"start":"multiple-selected"}return"normal"},Z=o=>x(o,p)<0||x(o,N)>0?"disabled":i.length<=0?"normal":h==="single"?x(o,i[0])===0?"selected":"normal":h==="multiple"?X(o):Q(o);f.useEffect(()=>{const o=T.current;o&&(H.current=o.getBoundingClientRect().height)},[]);const ee=o=>{if(h==="range"){if(o==="start"||o==="end")return n[o];if(o==="start-end")return n.startEnd}},_=()=>{const o=[];for(let m=1;m<=j;m++){const D=new Date(r.getFullYear(),r.getMonth(),m),M=Z(D),w={color:g,date:D,type:M,dayHeight:c,bottomInfo:ee(M)};o.push(y("div",{className:C("days-cell"),role:"gridcell",tabIndex:M==="disabled"?void 0:-1,style:{marginLeft:m===1?`${100*V/7}%`:void 0,marginBottom:V+m>28?0:void 0},onClick:()=>{S&&S(w)},children:u.day?u.day(w):y(Re,{...w})},m))}return o},q=(o,m,D)=>{if(m!=null)return typeof D=="boolean"||D==null?o(m):D(m)};return W("div",{className:C("month"),ref:T,children:[u.monthTitle!==!1&&y("div",{className:C("month-title"),children:q(v,r,u.monthTitle)}),W("div",{className:C("days"),ref:I,children:[u.monthMark!==!1&&y("div",{className:C("month-mark"),children:q(o=>o.getMonth()+1,r,u.monthMark)}),_()]})]})});we.displayName="CalendarMonth";const nt=we;function rt(t,e){const n=re(r=>{let l=t!=null?new Date(t):void 0;return Y(l)||(l=new Date),l=new Date(l.getFullYear(),l.getMonth(),l.getDate()),r!=null&&A(r,l)?r:l},[t]),g=re(r=>{let l=e!=null?new Date(e):void 0;return(!Y(l)||x(l,n)<0)&&(l=void 0),l==null&&(l=new Date(n.getFullYear(),n.getMonth()+7,0)),r!=null&&A(r,l)?r:l},[e,n]);return[n,g]}const L=(t,e,n)=>x(t,e)===-1?e:x(t,n)===1?n:t,ge=(t,e,n,g,r)=>{if(!e.length)return e;const l=tt();let c;if(t==="range"){const h=e[0]||l,i=e[1]||l;x(h,i)===1?e=[i,h]:e=[h,i],r!=null&&Ce(e[0],e[1])>r&&(e=[e[0],J(e[0],r-1)]);const u=L(e[0]||l,n,ye(g)),p=L(e[1]||l,De(n),g);c=[u,p]}else if(t==="multiple"){e=e.map(h=>L(h,n,g)),c=[];for(const h of e)c.findIndex(i=>A(i,h))<0&&(r!=null?c.length<r&&c.push(h):c.push(h))}else c=[L(e[0]||l,n,g)];return c},ot=ze({readonly:!1,slots:{},mode:"single",onClose:U,onConfirm:U,defaultValue:[],onChange:U}),ke=f.forwardRef((t,e)=>{const n=oe("calendar"),[{readonly:g,slots:r,onClose:l,mode:c,onConfirm:h,defaultValue:i,onChange:u},{title:p,color:N,minDate:S,maxDate:$,dayHeight:I,firstDayOfWeek:H,closeIcon:T,rangeAllowSameDay:O,rangeMaxSize:v,onRangeMaxSize:P,multiMaxSize:V,onMultiMaxSize:j,confirmDisabledText:Q,confirmText:X,className:Z,...ee}]=ot(t),_=f.useMemo(()=>Ge(H!=null?H:0,0,6),[H]),q=f.useMemo(()=>Je(I),[I]),[o,m]=rt(S,$),D=f.useRef(null),M=f.useRef(null),w=f.useRef(0),B=f.useRef({}),F=f.useMemo(()=>{const a=[];let s=new Date(o.getFullYear(),o.getMonth(),1);for(;G(s,m)<=0;)a.push(s),s=new Date(s.getFullYear(),s.getMonth()+1,1);return a},[o,m]);f.useImperativeHandle(e,()=>({element:D.current||null,reset:()=>{ne(He())},getValue:()=>R}));const ae=re(()=>{if(Array.isArray(i)){const a=i.map(s=>new Date(s));return a.every(Y)?a:[]}else if(i!=null){const a=new Date(i);return Y(a)?[a]:[]}else return[]},[]),[R,te]=f.useState(()=>ge(c,ae,o,m,c==="range"?v:V)),[le,Te]=f.useState(ae),ce=pe(u),[ie,Se,He]=We(()=>{const a=Y(R[0])?F.findIndex(s=>G(s,R[0])===0):-1;return Math.max(a,0)}),ue=f.useMemo(()=>c==="single"?R[0]!=null:c==="multiple"?R.length>0:c==="range"?R[0]!=null&&R[1]!=null:!1,[R,c]),ve=be(),Ve=a=>{if(g||a.type==="disabled")return;const{date:s}=a;let d;if(c==="range"){const[b,z]=R;if(b&&!z){const E=x(s,b);E===1?d=[b,s]:E===-1?d=[s,b]:O&&(d=[s,s]),d&&v!=null&&Ce(d[0],d[1])>v&&(d=[d[0],J(d[0],v-1)],P&&P())}else te([s])}else if(c==="multiple"){const b=R.findIndex(z=>A(z,s));b>=0?(d=[...R],d.splice(b,1)):V!=null&&R.length>=V?j&&j():d=[...R,s]}else c==="single"&&(d=[s]);d&&(te(d),Te(b=>d&&!me(b,d,A)?d:b))},Be=()=>{h(R)},Fe=()=>{var fe;const a=M.current;if(!a)return;const s=Ue(a),d=s+w.current,b=[];for(let k=0;k<F.length;k++)b.push(((fe=B.current[k])==null?void 0:fe.getHeight())||0);const z=b.reduce((k,Oe)=>k+Oe,0);if(d>z&&s>0)return;let E=0;for(let k=0;k<F.length;k++)if(E<=d&&E+b[k]>=s){Se(k);return}else E+=b[k]},ne=f.useCallback(a=>{const s=B.current[a],d=M.current;s&&d&&s.scrollIntoView(d)},[]);f.useEffect(()=>{const a=M.current;a&&(w.current=a.getBoundingClientRect().height)},[]),qe(()=>{const a=Y(R[0])?F.findIndex(s=>G(s,R[0])===0):-1;a<0||Qe(()=>{ne(a)})}),de(()=>{ce.current(le)},[le,ce]),de(()=>{te(a=>{const s=ge(c,a,o,m);return me(a,s,A)?a:s})},[m,o,c]),Ze(()=>{ne(ie)});const Ee=(a,s)=>{if(a!=null)return typeof s=="boolean"||s==null?ve(a):s(a)},Ye=()=>{const a=[...n.weekdays.slice(_,7),...n.weekdays.slice(0,_)];return W("div",{className:C("header"),children:[p!==!1&&y("div",{className:C("header-title"),children:p||n.title}),r.subTitle!==!1&&y("div",{className:C("header-subtitle"),children:Ee(F[ie],r.subTitle)}),y("div",{className:C("weekdays"),children:a.map((s,d)=>y("span",{className:C("weekday"),children:s},d))}),T!==!1&&y("span",{className:C("close-icon"),onClick:l,children:T||y(je,{name:"cross"})})]})},Ae=()=>y("div",{className:C("body"),ref:M,onScroll:Fe,children:F.map((a,s)=>y(nt,{color:N,month:a,dayHeight:q,firstDayOfWeek:_,mode:c,value:R,slots:{...r,monthTitle:s===0?!1:r.monthTitle},minDate:o,maxDate:m,onClickDay:Ve,rangeAllowSameDay:O,ref:d=>{B.current[s]=d}},s))}),$e=()=>{let a=r.footer;if(!a){const s=ue?X:Q;a=y(_e,{shape:"round",block:!0,type:"primary",color:N,className:C("confirm"),disabled:!ue,htmlType:"button",onClick:Be,children:s||n.confirm})}return y("div",{className:C("footer"),children:a})};return W("div",{className:he(C(),Z),...ee,ref:D,children:[Ye(),Ae(),$e()]})});ke.displayName="CalendarContainer";const se=ke,xe=f.forwardRef(({defaultValue:t,onChange:e,onConfirm:n,onCancel:g,...r},l)=>{const c=f.useRef(null),h=(i,u)=>{if(u&&i[0])return u(i[0])};return f.useImperativeHandle(l,()=>{var i;return{element:((i=c.current)==null?void 0:i.element)||null,reset:()=>{var u;return(u=c.current)==null?void 0:u.reset()},getValue:()=>{var p;const u=(p=c.current)==null?void 0:p.getValue();return u&&u[0]}}}),y(se,{...r,mode:"single",defaultValue:t,onChange:i=>{h(i,e)},onConfirm:i=>{h(i,n)},onClose:g,ref:c})});xe.displayName="Calendar";const st=xe,Ne=f.forwardRef(({defaultValue:t,onChange:e,onConfirm:n,onCancel:g,maxSize:r,onMaxSize:l,...c},h)=>{const i=(u,p)=>{if(p)return p(u)};return y(se,{...c,mode:"multiple",defaultValue:t,onChange:u=>{i(u,e)},onConfirm:u=>{i(u,n)},onClose:g,multiMaxSize:r,onMultiMaxSize:l,ref:h})});Ne.displayName="CalendarMulti";const at=Ne,Ie=f.forwardRef(({defaultValue:t,onChange:e,onConfirm:n,onCancel:g,allowSameDay:r,maxSize:l,onMaxSize:c,...h},i)=>{const u=(p,N)=>{if(N)return N(p)};return y(se,{...h,mode:"range",defaultValue:t,onChange:p=>{u(p,e)},onConfirm:p=>{u(p,n)},onClose:g,rangeAllowSameDay:r,rangeMaxSize:l,onRangeMaxSize:c,ref:i})});Ie.displayName="CalendarRange";const lt=Ie,K=st;K.Multi=at;K.Range=lt;K.Day=Re;const wt=K;export{wt as C};
