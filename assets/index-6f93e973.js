import{P as U,u as ce}from"./use-on-popup-open-52f79c86.js";import{r as e,j as m,F as E,f as ue,b as Y,c as fe,a as pe}from"./index-d9abb3b2.js";import{b as de,C as me,D as Ce}from"./index-23998fbd.js";import{c as Z}from"./config-component-props-c0788442.js";import{u as L}from"./use-merged-prop-78f8d6c6.js";import{c as G}from"./detect-9e279ab2.js";import{b as $,p as ve}from"./event-471798e4.js";import{g as ge}from"./scroll-a0e7f6b9.js";import{T as he}from"./touch-helper-e91fac31.js";import{O as Pe}from"./index-cf544936.js";import{n as d}from"./misc-276e45ca.js";import{u as Se}from"./use-merged-prop-ref-b6c7dc57.js";import{C as be}from"./CSSTransition-2913421a.js";import{u as F}from"./use-controlled-state-3e95143e.js";let D=0;const j="fnx-overflow-hidden";function ye(C,v={}){const i=v.locked||!1;e.useEffect(()=>{if(!i||!G())return;const r=new he,s=u=>{r.move(u);const n=r.touchData.deltaY>0?"10":"01",f=ge(u.target,C.current),{scrollHeight:a,offsetHeight:p,scrollTop:t}=f;let l="11";t===0?l=p>=a?"00":"01":t+p>=a&&(l="10"),l!=="11"&&r.isVertical()&&!(parseInt(l,2)&parseInt(n,2))&&ve(u,!0)};return $(document,"touchstart",r.start,{passive:!0}),$(document,"touchmove",s,{passive:!1}),D||document.body.classList.add(j),D++,()=>{document.removeEventListener("touchstart",r.start),document.removeEventListener("touchmove",s),D--,D||document.body.classList.remove(j)}},[i,C])}const K=({visible:C=!1,renderOnShow:v,destroyOnHide:i,mountTo:r,children:s})=>{const u=e.useContext(de),n=e.useRef(null),f=Se(r!=null?r:u.mountTo),a=e.useCallback(()=>{if(n.current!=null)return;const t=f.current;if(t===!1){n.current=!1;return}if(!G())return;let l;typeof t=="function"?l=t():t!=null?l=t:l=document.body;const c=document.createElement("div");l.appendChild(c),n.current=c},[f]),p=e.useCallback(()=>{const t=n.current;n.current=null,t&&setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},0)},[]);return e.useEffect(()=>()=>{p()},[p]),C?a():n.current!=null&&i?p():n.current==null&&!v&&a(),n.current==null?m(E,{}):n.current===!1?m(E,{children:s}):ue.createPortal(s,n.current)||m(E,{})};K.displayName="Portal";const X=K,xe="fnx-popup",z=pe(xe);let Te=2e3;const Ee=Z({visible:!1,renderOnShow:!0,destroyOnHide:!1,lockScroll:!0,position:"center",overlay:!0,overlayCloseable:!0,onOverlayClick:d,onClose:d,onBeforeHide:d,onHide:d,onAfterHide:d,onBeforeShow:d,onShow:d,onAfterShow:d}),q=e.forwardRef((C,v)=>{const i=e.useRef(null),r=e.useContext(me.Context),[{visible:s,renderOnShow:u,destroyOnHide:n,lockScroll:f,position:a,overlay:p,overlayCloseable:t,onOverlayClick:l,onClose:c,onBeforeHide:k,onHide:S,onAfterHide:A,onBeforeShow:w,onShow:h,onAfterShow:b},{mountTo:R,transitionDuration:y,transitionName:x,round:H,safeAreaInsetTop:o,safeAreaInsetBottom:g,overlayClassName:_,overlayStyle:W,children:ee,className:te,style:oe,...ne}]=Ee(C);e.useImperativeHandle(v,()=>i.current);const[re,B]=e.useState(!1),[O,V]=e.useState(!1),[N,M]=e.useState(),T=L(r.transitionDuration,y),se=L(r.safeAreaInsetBottom,g),ae=L(r.safeAreaInsetTop,o),le=e.useMemo(()=>x||(a==="center"?"fnx-fade":z([`slide-${a}`])),[x,a]);ye(i,{locked:N!=null&&f}),e.useEffect(()=>{s?(M(++Te),V(!0),B(!1)):B(!0)},[s]);const ie=()=>{const P={};return N!=null&&(P.zIndex=N),O||(P.display="none"),T!=null&&T!==Ce.transitionDuration&&(P.transitionDuration=`${T}ms`),{...P,...oe}};return m(X,{renderOnShow:u,destroyOnHide:n,mountTo:R,visible:s||O,children:m(U.Provider,{value:{visible:s||O},children:Y(E,{children:[p&&m(Pe,{visible:s,className:_,style:W,zIndex:N,lockScroll:f,transitionDuration:T,role:t?"button":void 0,tabIndex:t?0:void 0,onClick:P=>{l(P),t&&s&&c()}}),m(be,{in:O&&!re,classNames:le,nodeRef:i,timeout:T||0,onEnter:w,onEntering:h,onEntered:b,onExit:k,onExiting:S,onExited:()=>{M(void 0),B(!1),V(!1),A()},children:m("div",{className:fe(z({round:H,[a]:a}),ae&&"fnx-safe-area-top",se&&"fnx-safe-area-bottom",te),style:ie(),role:"dialog",tabIndex:0,...ne,ref:i,children:ee})})]})})})});q.displayName="Popup";const J=q,Ie=Z({selectConfirmTrigger:"onConfirm",selectCancelTrigger:"onCancel",selectDefaultValuePropName:"defaultValue",trigger:"onClick",disabled:!1,onClose:d}),Q=e.forwardRef((C,v)=>{const[{selectConfirmTrigger:i,selectCancelTrigger:r,selectDefaultValuePropName:s,trigger:u,disabled:n,onClose:f},{visible:a,value:p,defaultValue:t,onChange:l,select:c,position:k,children:S,...A}]=Ie(C),{value:w,onChangeRef:h}=F({value:a,defaultValue:!1}),{value:b,onChangeRef:R}=F({value:p,defaultValue:t,onChange:l}),y=e.useCallback((o,g,..._)=>{g&&typeof g[o]=="function"&&g[o](..._)},[]),x=()=>e.isValidElement(c)?e.cloneElement(c,{...c.props,[s]:b!==void 0?b:c.props[s],[i]:(...o)=>{y(i,c.props,...o),R.current(...o),h.current(!1)},[r]:(...o)=>{y(r,c.props,...o),h.current(!1),f()}}):c,H=()=>{let o=S;return typeof S=="function"&&(o=S(b)),e.isValidElement(o)?e.cloneElement(o,{...o.props,[u]:(...g)=>{n||h.current(!0),y(u,o&&o.props,...g)}}):o};return Y(E,{children:[m(J,{visible:w,...A,position:k||"bottom",onClose:()=>{h.current(!1),f()},ref:v,children:x()}),H()]})});Q.displayName="PopupSelect";const Oe=Q,Ne=Oe,I=J;I.Portal=X;I.Select=Ne;I.Context=U;I.useOnPopupOpen=ce;const ze=I;export{ze as P};
