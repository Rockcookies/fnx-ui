import{r as d,j as g,c as te,a as oe,b as re}from"./index-d9abb3b2.js";import{c as ae}from"./config-component-props-c0788442.js";import{u as se}from"./use-controlled-state-3e95143e.js";import{u as P}from"./use-merged-prop-ref-b6c7dc57.js";import{a as ne}from"./index-2da9f8c4.js";import{b as A,p as le}from"./event-471798e4.js";import{T as ce}from"./touch-helper-e91fac31.js";import{a as B}from"./format-73c0cb3b.js";import{n as ie}from"./misc-276e45ca.js";const ue="fnx-rate",R=oe(ue),fe=ae({readonly:!1,disabled:!1,allowHalf:!1,count:5,touchable:!0,defaultValue:0,onChange:ie}),j=d.forwardRef((k,L)=>{const[{readonly:f,disabled:r,allowHalf:b,count:p,touchable:C,defaultValue:w,onChange:D},{size:_,color:F,voidColor:G,disabledColor:V,voidDisabledColor:X,className:U,character:Y,voidCharacter:$,gutter:I,value:q,...J}]=fe(k),M=Y||g(ne,{name:"star"}),K=$||M,{value:n,onChangeRef:O}=se({value:q,defaultValue:w,onChange:D}),S=P({readonly:f,disabled:r,allowHalf:b,count:p,touchable:C,defaultValue:w}),h=P(e=>{!r&&!f&&e!==n&&O.current(e)}),v=d.useRef(null),T=d.useRef({}),H=d.useMemo(()=>f||r||!C,[f,r,C]),Q=d.useMemo(()=>new Array(p).fill(0),[p]);d.useImperativeHandle(L,()=>v.current);const W=e=>{b?e===n?h.current(e-1):e>n?h.current(Number.isInteger(n)?e-.5:e):h.current(Number.isInteger(e)?e-1:e):e===n?h.current(e-1):h.current(e)};d.useEffect(()=>{const e=v.current;if(!e||f||r)return;const a=new ce;let t=[],c,m=Number.MAX_SAFE_INTEGER,N=Number.MIN_SAFE_INTEGER,E=!1;const ee=(i,l)=>{for(let o=t.length-1;o>0;o--)if(l>=c.top&&l<=c.bottom){if(i>t[o].left&&l>=t[o].top&&l<=t[o].top+t[o].height)return t[o].score}else{const u=l<c.top?m:N;if(i>t[o].left&&t[o].top===u)return t[o].score}return E?.5:1},y=i=>{a.start(i);const{count:l,allowHalf:o}=S.current;E=o,c=e.getBoundingClientRect(),t=[];for(let u=0;u<l;u++){const z=T.current[u],s=z?z.getBoundingClientRect():{top:0,left:0,height:0,width:0};m=Math.min(s.top,m),N=Math.max(s.top,N),E?t.push({score:u+.5,left:s.left,top:s.top,height:s.height},{score:u+1,left:s.left+s.width/2,top:s.top,height:s.height}):t.push({score:u+1,left:s.left,top:s.top,height:s.height})}},x=i=>{if(!H&&(a.move(i),a.isHorizontal())){const{clientX:l,clientY:o}=i.touches[0];le(i),h.current(ee(l,o))}};return A(e,"touchstart",y,{passive:!0}),A(e,"touchmove",x,{passive:!1}),()=>{e.removeEventListener("touchstart",y),e.removeEventListener("touchmove",x)}},[r,S,f,h,H]);const Z=e=>{const a=e+1,t={};I&&a!==p&&(t.paddingRight=B(I));let c={};return b&&n+.5>=a&&n<a?c={half:!0,active:!0}:c=a<=n?{full:!0}:{zero:!0},g("li",{ref:m=>{T.current[e]=m},role:"radio",style:t,className:R("item",c),tabIndex:r?void 0:0,"aria-setsize":p,"aria-posinset":a,"aria-checked":n>e,children:re("div",{className:R("item-wrapper"),onClick:()=>W(a),style:{fontSize:_!=null?B(_):"28px"},children:[g("div",{className:R("void-character"),style:{color:r?X:G},children:K}),g("div",{className:R("character"),style:{color:r?V:F},children:M})]})},e)};return g("ul",{className:te(R({disabled:r}),U),role:"radiogroup",tabIndex:r?void 0:0,"aria-disabled":r,"aria-readonly":f,...J,ref:v,children:Q.map((e,a)=>Z(a))})});j.displayName="Rate";const Ne=j;export{Ne as R};
