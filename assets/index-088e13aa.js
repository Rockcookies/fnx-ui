import{r as f,a as $e,j as p,c as ge}from"./index-8b435b75.js";import{B as Oe}from"./index-6f2e6b84.js";import{c as Pe}from"./config-component-props-c0788442.js";import{u as ne}from"./use-creation-3d9fab3f.js";import{u as _e}from"./use-get-state-34a6027d.js";import{u as he}from"./use-merged-prop-ref-bd8415d7.js";import{u as fe}from"./use-update-effect-311108d7.js";import{I as ze}from"./index-f0ac2a00.js";import{u as re}from"./index-ebeef9c4.js";import{u as We}from"./use-on-popup-open-26f1d831.js";import{g as F}from"./detect-9e279ab2.js";import{s as qe,a as Le}from"./scroll-a0e7f6b9.js";import{c as Ue,a as Ge}from"./format-3509efe4.js";import{n as L,r as Je,i as de}from"./misc-276e45ca.js";import{d as Ke}from"./raf-e95fb200.js";const Qe=t=>{f.useEffect(()=>{t()},[])},Xe=Qe,C=$e("fnx-calendar");function U(t,e){const n=t.getFullYear(),g=e.getFullYear();if(n===g){const r=t.getMonth(),l=e.getMonth();return r===l?0:r>l?1:-1}return n>g?1:-1}function k(t,e){const n=U(t,e);if(n===0){const g=t.getDate(),r=e.getDate();return g===r?0:g>r?1:-1}return n}function Y(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}const Ze=t=>new Date(t),pe=t=>G(t,-1),ye=t=>G(t,1),et=()=>{const t=new Date;return t.setHours(0,0,0,0),t};function G(t,e){const n=Ze(t);return n.setDate(n.getDate()+e),n}function De(t,e){const n=t.getTime();return(e.getTime()-n)/(1e3*60*60*24)+1}const Ce=f.forwardRef((t,e)=>{const{color:n,dayHeight:g,date:r,content:l,type:c,topInfo:h,bottomInfo:i,style:u,className:y,onClick:N,...T}=t,A=()=>{const j={height:g};if(n)switch(c){case"selected":case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":j.background=n;break;case"middle":j.color=n;break}return{...j,...u}};return p.jsxs("div",{className:ge(C("day",c),y),...T,onClick:c==="disabled"?L:N,style:A(),ref:e,children:[h&&p.jsx("div",{className:C("top-info"),children:h}),l||r.getDate(),i&&p.jsx("div",{className:C("bottom-info"),children:i})]})});Ce.displayName="CalendarDay";const xe=Ce;function Me(){const t=re("calendar");return f.useCallback(e=>Je(t.monthTitle,{year:e.getFullYear(),month:e.getMonth()+1}),[t.monthTitle])}const Re=f.forwardRef((t,e)=>{const n=re("calendar"),{color:g,month:r,firstDayOfWeek:l,dayHeight:c,mode:h,value:i,slots:u,minDate:y,maxDate:N,onClickDay:T,rangeAllowSameDay:A}=t,j=f.useRef(null),S=f.useRef(0),I=f.useRef(null),$=he(u),H=Me(),O=f.useCallback(o=>{const m=$.current.subTitle!==!1?j.current:I.current;if(!m)return;const D=m.getBoundingClientRect().top-o.getBoundingClientRect().top+o.scrollTop;qe(o,D)},[$]);f.useImperativeHandle(e,()=>({element:I.current,getHeight:()=>S.current,scrollIntoView:O}),[O]);const v=f.useMemo(()=>{let o=r.getDay();return l&&(o=(o+7-l)%7),o},[l,r]),z=f.useMemo(()=>new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),[r]),K=o=>{const[m,D]=i;if(!m)return"normal";const x=k(o,m);if(!D)return x===0?"start":"normal";const w=k(o,D);return A&&x===0&&w===0?"start-end":x===0?"start":w===0?"end":x>0&&w<0?"middle":"normal"},Q=o=>{const m=D=>i.findIndex(x=>k(x,D)===0)>=0;if(m(o)){const D=pe(o),x=ye(o),w=m(D),V=m(x);return w&&V?"multiple-middle":w?"end":V?"start":"multiple-selected"}return"normal"},X=o=>k(o,y)<0||k(o,N)>0?"disabled":i.length<=0?"normal":h==="single"?k(o,i[0])===0?"selected":"normal":h==="multiple"?Q(o):K(o);f.useEffect(()=>{const o=I.current;o&&(S.current=o.getBoundingClientRect().height)},[]);const Z=o=>{if(h==="range"){if(o==="start"||o==="end")return n[o];if(o==="start-end")return n.startEnd}},P=()=>{const o=[];for(let m=1;m<=z;m++){const D=new Date(r.getFullYear(),r.getMonth(),m),x=X(D),w={color:g,date:D,type:x,dayHeight:c,bottomInfo:Z(x)};o.push(p.jsx("div",{className:C("days-cell"),role:"gridcell",tabIndex:x==="disabled"?void 0:-1,style:{marginLeft:m===1?"".concat(100*v/7,"%"):void 0,marginBottom:v+m>28?0:void 0},onClick:()=>{T&&T(w)},children:u.day?u.day(w):p.jsx(xe,{...w})},m))}return o},W=(o,m,D)=>{if(m!=null)return typeof D=="boolean"||D==null?o(m):D(m)};return p.jsxs("div",{className:C("month"),ref:I,children:[u.monthTitle!==!1&&p.jsx("div",{className:C("month-title"),children:W(H,r,u.monthTitle)}),p.jsxs("div",{className:C("days"),ref:j,children:[u.monthMark!==!1&&p.jsx("div",{className:C("month-mark"),children:W(o=>o.getMonth()+1,r,u.monthMark)}),P()]})]})});Re.displayName="CalendarMonth";const tt=Re;function nt(t,e){const n=ne(r=>{let l=t!=null?new Date(t):void 0;return F(l)||(l=new Date),l=new Date(l.getFullYear(),l.getMonth(),l.getDate()),r!=null&&Y(r,l)?r:l},[t]),g=ne(r=>{let l=e!=null?new Date(e):void 0;return(!F(l)||k(l,n)<0)&&(l=void 0),l==null&&(l=new Date(n.getFullYear(),n.getMonth()+7,0)),r!=null&&Y(r,l)?r:l},[e,n]);return[n,g]}const q=(t,e,n)=>k(t,e)===-1?e:k(t,n)===1?n:t,me=(t,e,n,g,r)=>{if(!e.length)return e;const l=et();let c;if(t==="range"){const h=e[0]||l,i=e[1]||l;k(h,i)===1?e=[i,h]:e=[h,i],r!=null&&De(e[0],e[1])>r&&(e=[e[0],G(e[0],r-1)]);const u=q(e[0]||l,n,pe(g)),y=q(e[1]||l,ye(n),g);c=[u,y]}else if(t==="multiple"){e=e.map(h=>q(h,n,g)),c=[];for(const h of e)c.findIndex(i=>Y(i,h))<0&&(r!=null?c.length<r&&c.push(h):c.push(h))}else c=[q(e[0]||l,n,g)];return c},rt=Pe({readonly:!1,slots:{},mode:"single",onClose:L,onConfirm:L,defaultValue:[],onChange:L}),we=f.forwardRef((t,e)=>{const n=re("calendar"),[{readonly:g,slots:r,onClose:l,mode:c,onConfirm:h,defaultValue:i,onChange:u},{title:y,color:N,minDate:T,maxDate:A,dayHeight:j,firstDayOfWeek:S,closeIcon:I,rangeAllowSameDay:$,rangeMaxSize:H,onRangeMaxSize:O,multiMaxSize:v,onMultiMaxSize:z,confirmDisabledText:K,confirmText:Q,className:X,...Z}]=rt(t),P=f.useMemo(()=>Ue(S!=null?S:0,0,6),[S]),W=f.useMemo(()=>Ge(j),[j]),[o,m]=nt(T,A),D=f.useRef(null),x=f.useRef(null),w=f.useRef(0),V=f.useRef({}),B=f.useMemo(()=>{const a=[];let s=new Date(o.getFullYear(),o.getMonth(),1);for(;U(s,m)<=0;)a.push(s),s=new Date(s.getFullYear(),s.getMonth()+1,1);return a},[o,m]);f.useImperativeHandle(e,()=>({element:D.current||null,reset:()=>{te(Te())},getValue:()=>M}));const se=ne(()=>{if(Array.isArray(i)){const a=i.map(s=>new Date(s));return a.every(F)?a:[]}else if(i!=null){const a=new Date(i);return F(a)?[a]:[]}else return[]},[]),[M,ee]=f.useState(()=>me(c,se,o,m,c==="range"?H:v)),[ae,je]=f.useState(se),le=he(u),[ce,Ie,Te]=_e(()=>{const a=F(M[0])?B.findIndex(s=>U(s,M[0])===0):-1;return Math.max(a,0)}),ie=f.useMemo(()=>c==="single"?M[0]!=null:c==="multiple"?M.length>0:c==="range"?M[0]!=null&&M[1]!=null:!1,[M,c]),Se=Me(),He=a=>{if(g||a.type==="disabled")return;const{date:s}=a;let d;if(c==="range"){const[R,_]=M;if(R&&!_){const E=k(s,R);E===1?d=[R,s]:E===-1?d=[s,R]:$&&(d=[s,s]),d&&H!=null&&De(d[0],d[1])>H&&(d=[d[0],G(d[0],H-1)],O&&O())}else ee([s])}else if(c==="multiple"){const R=M.findIndex(_=>Y(_,s));R>=0?(d=[...M],d.splice(R,1)):v!=null&&M.length>=v?z&&z():d=[...M,s]}else c==="single"&&(d=[s]);d&&(ee(d),je(R=>d&&!de(R,d,Y)?d:R))},ve=()=>{h(M)},Ve=()=>{var ue;const a=x.current;if(!a)return;const s=Le(a),d=s+w.current,R=[];for(let b=0;b<B.length;b++)R.push(((ue=V.current[b])==null?void 0:ue.getHeight())||0);const _=R.reduce((b,Ae)=>b+Ae,0);if(d>_&&s>0)return;let E=0;for(let b=0;b<B.length;b++)if(E<=d&&E+R[b]>=s){Ie(b);return}else E+=R[b]},te=f.useCallback(a=>{const s=V.current[a],d=x.current;s&&d&&s.scrollIntoView(d)},[]);f.useEffect(()=>{const a=x.current;a&&(w.current=a.getBoundingClientRect().height)},[]),We(()=>{const a=F(M[0])?B.findIndex(s=>U(s,M[0])===0):-1;a<0||Ke(()=>{te(a)})}),fe(()=>{le.current(ae)},[ae,le]),fe(()=>{ee(a=>{const s=me(c,a,o,m);return de(a,s,Y)?a:s})},[m,o,c]),Xe(()=>{te(ce)});const Be=(a,s)=>{if(a!=null)return typeof s=="boolean"||s==null?Se(a):s(a)},Ee=()=>{const a=[...n.weekdays.slice(P,7),...n.weekdays.slice(0,P)];return p.jsxs("div",{className:C("header"),children:[y!==!1&&p.jsx("div",{className:C("header-title"),children:y||n.title}),r.subTitle!==!1&&p.jsx("div",{className:C("header-subtitle"),children:Be(B[ce],r.subTitle)}),p.jsx("div",{className:C("weekdays"),children:a.map((s,d)=>p.jsx("span",{className:C("weekday"),children:s},d))}),I!==!1&&p.jsx("span",{className:C("close-icon"),onClick:l,children:I||p.jsx(ze,{name:"cross"})})]})},Fe=()=>p.jsx("div",{className:C("body"),ref:x,onScroll:Ve,children:B.map((a,s)=>p.jsx(tt,{color:N,month:a,dayHeight:W,firstDayOfWeek:P,mode:c,value:M,slots:{...r,monthTitle:s===0?!1:r.monthTitle},minDate:o,maxDate:m,onClickDay:He,rangeAllowSameDay:$,ref:d=>{V.current[s]=d}},s))}),Ye=()=>{let a=r.footer;if(!a){const s=ie?Q:K;a=p.jsx(Oe,{shape:"round",block:!0,type:"primary",color:N,className:C("confirm"),disabled:!ie,htmlType:"button",onClick:ve,children:s||n.confirm})}return p.jsx("div",{className:C("footer"),children:a})};return p.jsxs("div",{className:ge(C(),X),...Z,ref:D,children:[Ee(),Fe(),Ye()]})});we.displayName="CalendarContainer";const oe=we,be=f.forwardRef(({defaultValue:t,onChange:e,onConfirm:n,onCancel:g,...r},l)=>{const c=f.useRef(null),h=(i,u)=>{if(u&&i[0])return u(i[0])};return f.useImperativeHandle(l,()=>{var i;return{element:((i=c.current)==null?void 0:i.element)||null,reset:()=>{var u;return(u=c.current)==null?void 0:u.reset()},getValue:()=>{var y;const u=(y=c.current)==null?void 0:y.getValue();return u&&u[0]}}}),p.jsx(oe,{...r,mode:"single",defaultValue:t,onChange:i=>{h(i,e)},onConfirm:i=>{h(i,n)},onClose:g,ref:c})});be.displayName="Calendar";const ot=be,ke=f.forwardRef(({defaultValue:t,onChange:e,onConfirm:n,onCancel:g,maxSize:r,onMaxSize:l,...c},h)=>{const i=(u,y)=>{if(y)return y(u)};return p.jsx(oe,{...c,mode:"multiple",defaultValue:t,onChange:u=>{i(u,e)},onConfirm:u=>{i(u,n)},onClose:g,multiMaxSize:r,onMultiMaxSize:l,ref:h})});ke.displayName="CalendarMulti";const st=ke,Ne=f.forwardRef(({defaultValue:t,onChange:e,onConfirm:n,onCancel:g,allowSameDay:r,maxSize:l,onMaxSize:c,...h},i)=>{const u=(y,N)=>{if(N)return N(y)};return p.jsx(oe,{...h,mode:"range",defaultValue:t,onChange:y=>{u(y,e)},onConfirm:y=>{u(y,n)},onClose:g,rangeAllowSameDay:r,rangeMaxSize:l,onRangeMaxSize:c,ref:i})});Ne.displayName="CalendarRange";const at=Ne,J=ot;J.Multi=st;J.Range=at;J.Day=xe;const Rt=J;export{Rt as C};
