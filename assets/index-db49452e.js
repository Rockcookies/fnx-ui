import{r,j as a,F as B,b as M,c as C,a as U}from"./index-cd4e7e60.js";import{c as _}from"./config-component-props-c0788442.js";import{u as $}from"./use-update-effect-c068296a.js";import{I as N}from"./index-429bf8ad.js";import{a as w}from"./format-73c0cb3b.js";import{n as I}from"./misc-276e45ca.js";import{u as G}from"./use-merged-prop-ref-cafd8c02.js";import{I as E}from"./detect-9e279ab2.js";function k(e){if(!e)return;const s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=e.getBoundingClientRect();if(o){const{top:t,bottom:c,left:l,right:u}=o;return c>0&&t<=i&&l<=s&&u>0}return!1}function q(e){const[s,i]=r.useState(()=>!E||!window.IntersectionObserver?!0:k(e==null?void 0:e.current));return r.useEffect(()=>{const o=e==null?void 0:e.current;if(!o||!E||!window.IntersectionObserver)return;const t=new IntersectionObserver(c=>{c.some(l=>l.intersectionRatio>0?(i(!0),t.disconnect(),!0):!1)},{threshold:[1e-4]});return t.observe(o),()=>{t.disconnect()}},[e]),s}const P=e=>{const s=q(e.nodeRef),i=G(I,e.onActive);return r.useEffect(()=>{s&&i.current()},[s,i]),a(B,{})};P.displayName="LazyDetector";const J=P,K="fnx-image",d=U(K),Q=_({fit:"fill",radius:0,slots:{},onLoad:I,onError:I,lazy:!1}),T=a(N,{name:"photo"}),X=a(N,{name:"photo-fail"}),S=r.forwardRef((e,s)=>{const[{fit:i,radius:o,slots:t,onLoad:c,onError:l,lazy:u},{src:L,width:m,position:z,height:f,alt:O,round:j,className:x,style:H,children:R,...V}]=Q(e),p=r.useRef(null),[W,y]=r.useState(!1),[h,b]=r.useState(!1),[v,A]=r.useState(!u),g=v?L:void 0;r.useImperativeHandle(s,()=>p.current),$(()=>{y(!1),b(!1)},[g]);const D=r.useMemo(()=>{const n={};return m!=null&&(n.width=w(m)),f!=null&&(n.height=w(f)),o&&(n.overflow="hidden",n.borderRadius=w(o)),n},[m,f,o]),F=()=>{if(!h&&!W&&t.loading!==!1)return a("span",{className:d("loading"),children:t.loading||T});if(h&&t.error!==!1)return a("span",{className:d("error"),children:t.error||X})};return M("span",{className:C([d({round:j})],x),style:{...D,...H},...V,ref:p,children:[u&&!v&&a(J,{nodeRef:p,onActive:()=>A(!0)}),!h&&g&&a("img",{className:d("img"),src:g,alt:O,style:{objectFit:i,objectPosition:z},onLoad:n=>{y(!0),c(n)},onError:n=>{b(!0),l(n)}}),F(),R]})});S.displayName="Image";const ie=S;export{ie as I};
