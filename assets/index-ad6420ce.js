import{r as s,j as M,a as pe,b as K,c as F}from"./index-d9abb3b2.js";import{C as xe}from"./index-23998fbd.js";import{c as Me}from"./config-data-names-7d1179b6.js";import{u as Pe,c as me}from"./format-73c0cb3b.js";import{u as Ie}from"./use-creation-81fc62b8.js";import{u as ne}from"./use-merged-prop-ref-b6c7dc57.js";import{u as J}from"./use-safe-state-6c526362.js";import{u as oe}from"./use-update-effect-e4ebe9a3.js";import{b as Y,p as Ne}from"./event-471798e4.js";import{T as we}from"./touch-helper-e91fac31.js";import{i as de}from"./misc-276e45ca.js";import{L as Re}from"./index-19e0971a.js";import{u as Te}from"./index-2758f43a.js";import{d as ye}from"./constants-905d732f.js";import{u as ce}from"./use-get-state-80dac10e.js";const Ee=Me({label:"label",value:"value",disabled:"disabled",children:"children"});function se({dataNames:t,optionHeight:i,transitionDuration:o,visibleOptionsCount:n,...f}){const r=s.useContext(xe.Context),p=s.useMemo(()=>Pe(i||44),[i]),u=Ee(t),m=o||r.transitionDuration;return[{optionHeight:p,visibleOptionsCount:n||6,transitionDuration:m,dataNames:u},f]}function he(t,i,o){t=me(t,0,Math.max(i.length-1,0));for(let n=t;n<i.length;n++)if(!o(i[n]))return n;for(let n=t-1;n>=0;n--)if(!o(i[n]))return n;return t}const Ve="fnx-picker-column",Q=pe(Ve),He=t=>{const i=window.getComputedStyle(t),o=i.transform||i.webkitTransform,n=o.slice(7,o.length-1).split(", ")[5];return Number(n)},ue=300,De=15,le=(t,i)=>t*(i-1)/2,W=(t,i)=>he(t,i,o=>o.disabled),ge=s.forwardRef((t,i)=>{const{optionHeight:o,visibleOptionsCount:n,defaultValue:f,data:r,dataNames:p}=t,u=s.useRef(t),m=s.useRef(null),P=s.useRef(null),[w,O]=Ie(e=>{const c=[],v=[];for(const l of Array.isArray(r)?r:[])typeof l=="string"||typeof l=="number"?(c.push(l),v.push({value:l,disabled:!1})):(c.push(p.label(l)),v.push({value:p.value(l),disabled:!!p.disabled(l)}));if(!e)return[c,v];const[,T]=e;return de(T,v,(l,b)=>l.value===b.value&&l.disabled===b.disabled)?[c,T]:[c,v]},[p,r]),[k,I]=J(()=>W(O.findIndex(({value:e})=>e===f),O)),d=s.useMemo(()=>{const e=O[k];if(e&&!e.disabled)return e.value},[k,O]),h=ne(d),[N,C]=J(()=>-k*o),a=ne({data:r,options:O,activeIndex:k,wrapperOffset:N,optionHeight:o}),y=s.useCallback(e=>(I(e),a.current.activeIndex=e,e),[I,a]),x=s.useCallback(e=>(C(e),a.current.wrapperOffset=e,e),[C,a]),[$,V]=J(),H=s.useCallback(()=>{V(void 0),a.current.swipingTimer&&(clearTimeout(a.current.swipingTimer),a.current.swipingTimer=void 0)},[V,a]),q=s.useMemo(()=>le(o,n),[o,n]),g=s.useCallback((e,{animation:c})=>{const{transitionDuration:v}=u.current,{optionHeight:T,options:l}=a.current;H(),e=W(e,l),x(-e*T);const b=()=>{H(),y(e)};c?(V(v),a.current.swipingTimer=setTimeout(b,v)):b()},[H,y,V,x,a]),R=s.useMemo(()=>({element:m.current,getActiveValue:()=>h.current,getActiveIndex:()=>a.current.activeIndex,getActiveOption:()=>{const{activeIndex:e,data:c}=a.current;return(c||[])[e]}}),[h,a]);s.useImperativeHandle(i,()=>R,[R]),s.useEffect(()=>{const{activeIndex:e}=a.current,c=W(e,O);c!==e&&g(c,{animation:!1})},[O,a,g]),oe(()=>{const{onChange:e}=u.current;if(d!=null&&e){const{activeIndex:c}=a.current;e(d,c)}},[d,a]),s.useEffect(()=>{const e=m.current;if(!e)return;let c,v=0,T=0,l=0,b=0;const B=A=>{c=new we,c.start(A);const{swipingTimer:_,optionHeight:U,wrapperOffset:L}=a.current;if(_){const z=P.current?He(P.current):0,{visibleOptionsCount:G}=u.current;v=Math.min(0,z-le(U,G))}else v=L;H(),V(void 0),b=Date.now(),T=v,l=x(v)},S=A=>{if(!c)return;c.move(A),Ne(A,!0);const{optionHeight:_,options:U}=a.current;l=x(me(v+c.touchData.deltaY,-U.length*_,_));const L=Date.now();L-b>ue&&(b=L,T=l)},j=()=>{if(!c)return;const A=l-T,_=Date.now()-b;if(_<ue&&Math.abs(A)>De){const ke=Math.abs(A/_);l=l+ke/.003*(A<0?-1:1)}const{optionHeight:L,options:z}=a.current,G=W(Math.round(-l/L),z);c=void 0,g(G,{animation:!0})};return Y(e,"touchstart",B,{passive:!0}),Y(e,"touchmove",S,{passive:!1}),Y(e,"touchend",j,{passive:!0}),Y(e,"touchcancel",j,{passive:!0}),()=>{e.removeEventListener("touchstart",B),e.removeEventListener("touchmove",S),e.removeEventListener("touchend",j),e.removeEventListener("touchcancel",j)}},[m,a,H,x,g,V]);const E=()=>{const e={height:`${o}px`},c={transform:`translate3d(0, ${N+q}px, 0)`};return $!=null&&(c.transitionDuration=`${$}ms`),M("ul",{className:Q("wrapper"),style:c,ref:P,children:O.map(({value:v,disabled:T},l)=>{const b=w[l];return M("li",{className:Q("option",{selected:k===l,disabled:T}),tabIndex:0,role:"button",style:e,onClick:()=>g(l,{animation:!0}),children:typeof b=="string"?M("div",{className:"fnx-ellipsis",children:b}):b},v)})})};return M("div",{className:Q(),ref:m,children:E()})});ge.displayName="PickerColumn";const re=ge,Se="fnx-picker",D=pe(Se),ve=s.forwardRef((t,i)=>{const{optionHeight:o,visibleOptionsCount:n,toolbarPosition:f,toolbar:r,title:p,confirmButton:u,cancelButton:m,loading:P,onCancel:w,onConfirm:O,className:k,children:I,...d}=t,h=Te("picker"),N=s.useMemo(()=>o*n,[o,n]),C=()=>{if(p!==!1)return s.isValidElement(p)?p:p&&M("div",{className:F(D("title"),"fnx-ellipsis"),children:p})},a=()=>{if(m!==!1)return s.isValidElement(m)?m:M("button",{type:"button",className:D("cancel"),onClick:w,children:m||h.cancel})},y=()=>{if(u!==!1)return s.isValidElement(u)?u:M("button",{type:"button",className:D("confirm"),onClick:O,children:u||h.confirm})},x=()=>{if(r!==!1)return s.isValidElement(r)?r:K("div",{className:D("toolbar"),children:[a(),C(),y()]})};return K("div",{className:F(D(),k),...d,ref:i,children:[f!=="bottom"&&x(),K("div",{className:D("columns"),style:{height:`${N}px`},children:[I,M("div",{className:D("mask"),style:{backgroundSize:`100% ${(N-o)/2}px`}}),M("div",{className:F(D("frame"),ye),style:{height:`${o}px`}})]}),f==="bottom"&&x(),P&&M(Re,{className:D("loading")})]})});ve.displayName="PickerContainer";const ie=ve,Ce=s.forwardRef((t,i)=>{const[{optionHeight:o,visibleOptionsCount:n,transitionDuration:f,dataNames:r},{defaultValue:p,data:u,onChange:m,onConfirm:P,onCancel:w,...O}]=se(t),k=s.useRef(null),I=s.useRef(null),d=s.useMemo(()=>({element:k.current,getValue:()=>{var h;return(h=I.current)==null?void 0:h.getActiveValue()},getOption:()=>{var h;return(h=I.current)==null?void 0:h.getActiveOption()}}),[]);return s.useImperativeHandle(i,()=>d,[d]),M(ie,{...O,optionHeight:o,visibleOptionsCount:n,ref:k,onConfirm:()=>{P&&P(d.getValue(),d.getOption())},onCancel:()=>{w&&w()},children:M(re,{optionHeight:o,visibleOptionsCount:n,transitionDuration:f,defaultValue:p,data:u,dataNames:r,onChange:()=>{m&&m(d.getValue(),d.getOption())},ref:I})})});Ce.displayName="Picker";const Ae=Ce,$e=Ae,fe=(t=999999)=>Math.floor(Math.random()*t)+1,X=(t,i)=>{const o=[];for(let n=0;n<t.length;n++){const f=t[n],r=(i||[])[n][f];o.push(r)}return o},Z=(t,i,o)=>{const n=t.map(f=>i.value(f));return o&&de(o,n)?o:n},ee=(t,i,o)=>{const n=o||[],f=[];let r=0;for(;t&&t.length>0;){const p=n[r];let u=p!=null?t.findIndex(m=>i.value(m)===p):0;u=he(u,t,m=>!!i.disabled(m)),f[r]=u,t=i.children(t[u])||[],r++}return f},te=(t,i,o)=>{const n=[];for(let f=0;f<o.length;f++)if(t&&t.length){n.push(t);const r=o[f];t=t[r]&&i.children(t[r])||[]}else n.push([]);return n},be=s.forwardRef((t,i)=>{const[{optionHeight:o,visibleOptionsCount:n,transitionDuration:f,dataNames:r},{defaultValue:p,data:u,onChange:m,onConfirm:P,onCancel:w,...O}]=se(t),k=s.useRef(null),I=ne(m),[d,h]=s.useState(()=>ee(u||[],r,p)),[N,C]=s.useState(()=>te(u||[],r,d).map(g=>[0,g])),[a,y,x]=ce(()=>X(d,N.map(([,g])=>g))),[$,V,H]=ce(()=>p||Z(a,r));s.useImperativeHandle(i,()=>({element:k.current,getOptions:()=>x(),getValue:()=>H()}),[x,H]);const q=(g,R,E)=>{const e=g[R]&&r.children(g[R])||[],c=ee(e,r),v=[...d.slice(0,E),R,...c],T=fe(),l=te(e,r,c).map(S=>[T,S]),b=[...N.slice(0,E+1),...l],B=X(v,b.map(([,S])=>S));h(v),C(b),y(B),V(S=>Z(B,r,S))};return oe(()=>{const g=ee(u||[],r,H()),R=te(u||[],r,g),E=X(g,R);h(g),C(()=>{const e=fe();return R.map(c=>[e,c])}),y(E),V(e=>Z(E,r,e))},[u,r,V,H]),oe(()=>{const g=I.current;g&&g($,x())},[I,$,x]),M(ie,{...O,optionHeight:o,visibleOptionsCount:n,ref:k,onConfirm:()=>{P&&P($,a)},onCancel:()=>{w&&w()},children:N.map(([g,R],E)=>M(re,{optionHeight:o,visibleOptionsCount:n,transitionDuration:f,defaultValue:$[E],data:R,dataNames:r,onChange:(e,c)=>q(R,c,E)},`${g}-${E}`))})});be.displayName="PickerCascade";const _e=be,Le=_e,Oe=s.forwardRef((t,i)=>{const[{optionHeight:o,visibleOptionsCount:n,transitionDuration:f,dataNames:r},{defaultValue:p,data:u,onChange:m,onConfirm:P,onCancel:w,...O}]=se(t),k=s.useRef(null),I=s.useRef({}),d=s.useMemo(()=>Array.isArray(u)?u:[],[u]),h=s.useMemo(()=>{function N(C){const a=[];for(let y=0;y<d.length;y++){const x=I.current[y];x&&a.push(C(x))}return a}return{element:k.current,getValue:()=>N(C=>C.getActiveValue()),getOptions:()=>N(C=>C.getActiveOption())}},[d.length]);return s.useImperativeHandle(i,()=>h,[h]),M(ie,{...O,optionHeight:o,visibleOptionsCount:n,ref:k,onConfirm:()=>{P&&P(h.getValue(),h.getOptions())},onCancel:()=>{w&&w()},children:d.map((N,C)=>M(re,{optionHeight:o,visibleOptionsCount:n,transitionDuration:f,defaultValue:p&&p[C],data:N,dataNames:r,onChange:()=>{m&&m(h.getValue(),h.getOptions())},ref:a=>{I.current[C]=a}},C))})});Oe.displayName="PickerMulti";const Be=Oe,je=Be,ae=$e;ae.Multi=je;ae.Cascade=Le;const ot=ae;export{ot as P};
