import{r,j as p,c as Z,a as ee}from"./index-8b435b75.js";import{C as te}from"./index-fdd3a7d6.js";import{c as re}from"./config-component-props-c0788442.js";import{u as se}from"./use-merged-prop-78f8d6c6.js";import{u as oe}from"./use-merged-prop-ref-bd8415d7.js";import{u as ne}from"./use-update-effect-311108d7.js";import{L as ce}from"./index-f59b2ddc.js";import{u as ae}from"./index-ebeef9c4.js";import{b as g,p as ie}from"./event-471798e4.js";import{a as ue,g as le}from"./scroll-a0e7f6b9.js";import{T as fe}from"./touch-helper-e91fac31.js";import{n as M}from"./misc-276e45ca.js";const me="fnx-pull-refresh",v=ee(me),k=50,pe=re({disabled:!1,successDuration:500,slots:{},indicatorHeight:k,refreshing:!1,onRefresh:M,onChange:M}),$=r.forwardRef((_,w)=>{const C=ae("pull-refresh"),A=r.useContext(te.Context),[{disabled:R,successDuration:U,slots:x,indicatorHeight:D,refreshing:u,onRefresh:Y,onChange:z},{transitionDuration:B,className:F,style:G,children:O,...V}]=pe(_),q=se(A.transitionDuration,B),c=oe({disabled:R,successDuration:U,transitionDuration:q,slots:x,indicatorHeight:D,refreshing:u,onRefresh:Y,onChange:z}),d=r.useRef(null),y=r.useRef(null);r.useImperativeHandle(w,()=>d.current);const l=r.useRef(),[o,a]=r.useState("normal"),[J,H]=r.useState(0),[T,E]=r.useState(),[S,f]=r.useState(0),L=r.useMemo(()=>!R&&o!=="loading"&&o!=="success",[R,o]);r.useEffect(()=>{const e=y.current;if(!e||!L)return;const n=new fe;let i=!1,N=!1;const j=t=>{i=(d.current?ue(le(d.current)):0)===0,i&&(H(0),n.start(t))},X=(t,s)=>(t>s&&(t<s*2?t=s+(t-s)/2:t=s*1.5+(t-s*2)/4),Math.round(t)),b=t=>{j(t)},I=t=>{i||j(t),n.move(t);const{deltaY:s}=n.touchData;if(i&&s>=0&&n.isVertical()){ie(t);const P=c.current.indicatorHeight,m=X(s,P);N=m!==0&&m>P,f(m),m===0?a("normal"):m<P?a("pulling"):a("loosing")}},h=()=>{if(i&&n.touchData.deltaY){const{transitionDuration:t,indicatorHeight:s}=c.current;H(t),N?(f(s),a("loading")):(f(0),a("normal"))}};return g(e,"touchstart",b,{passive:!0}),g(e,"touchmove",I,{passive:!1}),g(e,"touchend",h,{passive:!0}),g(e,"touchcancel",h,{passive:!0}),()=>{e.removeEventListener("touchstart",b),e.removeEventListener("touchmove",I),e.removeEventListener("touchend",h),e.removeEventListener("touchcancel",h)}},[c,L]),r.useEffect(()=>{if(o!=="loading")return;const e=!!u;if(T==null){E(e),c.current.onRefresh();return}if(!u&&T!==u){E(void 0);const{slots:n,successDuration:i}=c.current;if(n.success){a("success"),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{f(0),a("normal")},i);return}f(0),a("normal");return}E(u)},[o,u,T,c]),r.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),ne(()=>{c.current.onChange({status:o})},[c,o]);const K=()=>{const e={};return D!==k&&(e.height="".concat(D,"px")),e},Q=()=>{const e={transitionDuration:"".concat(J,"ms")};return S>0&&(e.transform="translate3d(0, ".concat(S,"px, 0)")),e},W=()=>{const e=x&&x[o];if(typeof e=="function")return e(S);if(e)return e;if(o==="loading")return p.jsx(ce,{size:16,text:C[o]});const n=C[o];if(n)return p.jsx("div",{className:v("text"),children:n})};return p.jsx("div",{className:Z(v(),F),style:G,...V,ref:d,children:p.jsxs("div",{className:v("track"),style:Q(),ref:y,children:[p.jsx("div",{className:v("indicator"),style:K(),children:W()}),O]})})});$.displayName="PullRefresh";const ye=$;export{ye as P};
