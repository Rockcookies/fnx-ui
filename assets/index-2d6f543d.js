import{r as p,j as d,c as te,a as oe}from"./index-8b435b75.js";import{c as re}from"./config-component-props-c0788442.js";import{u as ae}from"./use-controlled-state-e2423fe7.js";import{u as z}from"./use-merged-prop-ref-bd8415d7.js";import{a as se}from"./index-f0ac2a00.js";import{b as P,p as ne}from"./event-471798e4.js";import{T as le}from"./touch-helper-e91fac31.js";import{a as A}from"./format-3509efe4.js";import{n as ce}from"./misc-276e45ca.js";const ie="fnx-rate",R=oe(ie),ue=re({readonly:!1,disabled:!1,allowHalf:!1,count:5,touchable:!0,defaultValue:0,onChange:ce}),B=p.forwardRef((k,L)=>{const[{readonly:f,disabled:r,allowHalf:C,count:m,touchable:b,defaultValue:w,onChange:D},{size:x,color:F,voidColor:G,disabledColor:V,voidDisabledColor:X,className:U,character:Y,voidCharacter:$,gutter:_,value:q,...J}]=ue(k),I=Y||d.jsx(se,{name:"star"}),K=$||I,{value:n,onChangeRef:O}=ae({value:q,defaultValue:w,onChange:D}),M=z({readonly:f,disabled:r,allowHalf:C,count:m,touchable:b,defaultValue:w}),h=z(e=>{!r&&!f&&e!==n&&O.current(e)}),v=p.useRef(null),S=p.useRef({}),T=p.useMemo(()=>f||r||!b,[f,r,b]),Q=p.useMemo(()=>new Array(m).fill(0),[m]);p.useImperativeHandle(L,()=>v.current);const W=e=>{C?e===n?h.current(e-1):e>n?h.current(Number.isInteger(n)?e-.5:e):h.current(Number.isInteger(e)?e-1:e):e===n?h.current(e-1):h.current(e)};p.useEffect(()=>{const e=v.current;if(!e||f||r)return;const a=new le;let t=[],c,g=Number.MAX_SAFE_INTEGER,N=Number.MIN_SAFE_INTEGER,E=!1;const ee=(i,l)=>{for(let o=t.length-1;o>0;o--)if(l>=c.top&&l<=c.bottom){if(i>t[o].left&&l>=t[o].top&&l<=t[o].top+t[o].height)return t[o].score}else{const u=l<c.top?g:N;if(i>t[o].left&&t[o].top===u)return t[o].score}return E?.5:1},j=i=>{a.start(i);const{count:l,allowHalf:o}=M.current;E=o,c=e.getBoundingClientRect(),t=[];for(let u=0;u<l;u++){const y=S.current[u],s=y?y.getBoundingClientRect():{top:0,left:0,height:0,width:0};g=Math.min(s.top,g),N=Math.max(s.top,N),E?t.push({score:u+.5,left:s.left,top:s.top,height:s.height},{score:u+1,left:s.left+s.width/2,top:s.top,height:s.height}):t.push({score:u+1,left:s.left,top:s.top,height:s.height})}},H=i=>{if(!T&&(a.move(i),a.isHorizontal())){const{clientX:l,clientY:o}=i.touches[0];ne(i),h.current(ee(l,o))}};return P(e,"touchstart",j,{passive:!0}),P(e,"touchmove",H,{passive:!1}),()=>{e.removeEventListener("touchstart",j),e.removeEventListener("touchmove",H)}},[r,M,f,h,T]);const Z=e=>{const a=e+1,t={};_&&a!==m&&(t.paddingRight=A(_));let c={};return C&&n+.5>=a&&n<a?c={half:!0,active:!0}:c=a<=n?{full:!0}:{zero:!0},d.jsx("li",{ref:g=>{S.current[e]=g},role:"radio",style:t,className:R("item",c),tabIndex:r?void 0:0,"aria-setsize":m,"aria-posinset":a,"aria-checked":n>e,children:d.jsxs("div",{className:R("item-wrapper"),onClick:()=>W(a),style:{fontSize:x!=null?A(x):"28px"},children:[d.jsx("div",{className:R("void-character"),style:{color:r?X:G},children:K}),d.jsx("div",{className:R("character"),style:{color:r?V:F},children:I})]})},e)};return d.jsx("ul",{className:te(R({disabled:r}),U),role:"radiogroup",tabIndex:r?void 0:0,"aria-disabled":r,"aria-readonly":f,...J,ref:v,children:Q.map((e,a)=>Z(a))})});B.displayName="Rate";const ve=B;export{ve as R};
