import{r as s,R as ne,j as H,c as re,a as ce}from"./index-8b435b75.js";import{c as de}from"./config-component-props-c0788442.js";import{u as me}from"./use-merged-prop-ref-bd8415d7.js";import{I as ie}from"./detect-9e279ab2.js";import{a as he,l as ve,b as K,p as ge}from"./event-471798e4.js";import{u as Se}from"./use-on-popup-open-26f1d831.js";import{T as xe}from"./touch-helper-e91fac31.js";import{n as Ie}from"./misc-276e45ca.js";import{d as ye}from"./raf-e95fb200.js";import{t as be}from"./react-a0edb2dd.js";import{u as F}from"./use-safe-state-d07d3d84.js";import{c as ze}from"./format-3509efe4.js";function Ee(){const[c,O]=s.useState(()=>ie?window.innerWidth:0),[I,n]=s.useState(()=>ie?window.innerHeight:0);return s.useEffect(()=>he(()=>{O(window.innerWidth),n(window.innerHeight)}),[]),s.useMemo(()=>({width:c,height:I}),[c,I])}const Te=({propsRef:c,swipeLength:O,rootRef:I})=>{const n=s.useRef({swipeLength:0,swipeSize:0,wrapperOffset:0});n.current.swipeLength=O;const[J,X]=F(0),z=s.useCallback(e=>{X(e),n.current.wrapperOffset=e},[X]),[Q,y]=F(0),j=s.useCallback(e=>{y(e),n.current.swipeSize=e},[y]),[k,w]=s.useState("none"),[_,R]=F(),E=s.useCallback(e=>{R(e),n.current.activeIndex=e},[R]),[Y,o]=F(!1),b=s.useCallback((e,a={})=>{const{swipeLength:r,swipeSize:p,swipingTimer:u}=n.current;if(a.critical&&-e>=(r-1)*p?w("first"):a.critical&&e>=0?w("last"):w("none"),z(e),a.swiping){const{duration:C}=c.current;o(!0),u&&clearTimeout(u),n.current.swipingTimer=setTimeout(()=>{const{activeIndex:l=0,swipeSize:f}=n.current;n.current.swipingTimer=void 0,w("none"),o(!1),z(-l*f)},C)}},[c,o,z]),T=s.useCallback(()=>{const{activeIndex:e=0,swipeLength:a,swipeSize:r}=n.current;if(a<=1)return;const{loop:p}=c.current,u=e>=a-1?0:e+1;E(u),p&&e===a-1?b(-a*r,{swiping:!0,critical:!0}):b(-u*r,{swiping:!0})},[b,c,E]),U=s.useCallback(()=>{const{activeIndex:e=0,swipeLength:a,swipeSize:r}=n.current;if(a<=1)return;const{loop:p}=c.current,u=e<=0?a-1:e-1;E(u),p&&e===0?b(r,{swiping:!0,critical:!0}):b(-u*r,{swiping:!0})},[b,c,E]),Z=s.useCallback(()=>{o(!1);const{swipingTimer:e}=n.current;e&&clearTimeout(e)},[o]),d=s.useCallback(()=>{const{autoplayTimer:e}=n.current;e&&clearTimeout(e)},[]),$=s.useCallback(()=>{const{autoplay:e}=c.current,{swipeLength:a}=n.current;d(),!(e<=0||a<=1)&&(n.current.autoplayTimer=setTimeout(()=>{T(),$()},e))},[T,c,d]),W=s.useCallback(()=>{var h;const{swipeLength:e,activeIndex:a}=n.current,{defaultActiveIndex:r}=c.current,{vertical:p,height:u,width:C}=c.current;let l=p?u:C;if(l<=0){const M=(h=I.current)==null?void 0:h.getBoundingClientRect();M&&(l=p?M.height:M.width)}const f=ze(a!=null?a:r,0,Math.max(e-1,0)),L=-f*l;o(!1),w("none"),j(l),E(f),z(L)},[c,I,E,j,o,z]);return{stateRef:n,wrapperOffset:J,setWrapperOffset:z,swipeSize:Q,swipeOffset:k,activeIndex:_,setActiveIndex:E,swiping:Y,move:b,next:T,prev:U,stopTransition:Z,stopAutoplay:d,startAutoplay:$,reload:W}},Le=Te,Ae="fnx-swipe",G=ce(Ae),Ce=de({height:0,width:0,autoplay:3e3,duration:500,defaultActiveIndex:0,loop:!0,vertical:!1,touchable:!0,indicator:null,stopPropagation:!0,onActiveIndexChange:Ie}),oe=s.forwardRef((c,O)=>{const[I,{className:n,children:J,...X}]=Ce(c),{autoplay:z,duration:Q,vertical:y,touchable:j,indicator:k}=I,w=me(I),_=s.useRef(null),R=s.useRef(null),E=Ee(),Y=be(J),o=Y.filter(t=>ne.isValidElement(t)).length,b=s.useRef(!1),{stateRef:T,wrapperOffset:U,setWrapperOffset:Z,swipeSize:d,swipeOffset:$,activeIndex:W,setActiveIndex:e,swiping:a,move:r,next:p,prev:u,stopTransition:C,stopAutoplay:l,startAutoplay:f,reload:L}=Le({propsRef:w,swipeLength:o,rootRef:_}),h=s.useCallback(t=>{C(),l(),t&&t(),f()},[f,l,C]),M=s.useMemo(()=>({element:_.current||null,wrapper:R.current||null,reset:()=>{h(L)},next:()=>{h(p)},prev:()=>{h(u)},swipeTo:(t,i)=>{h(()=>{const{swipeSize:m}=T.current;e(t),r(-t*m,{swiping:i&&i.animation})})}}),[r,p,u,L,h,e,T]);s.useImperativeHandle(O,()=>M,[M]);const le=s.useMemo(()=>{const t=[];for(let i=0;i<o;i++){const m={};d>0&&$&&(i===0&&$==="first"&&(m.transform="translate".concat(y?"Y":"X","(").concat(o*d,"px)")),i===o-1&&$==="last"&&(m.transform="translate".concat(y?"Y":"X","(-").concat(o*d,"px)"))),d>0&&(m[y?"height":"width"]="".concat(d,"px")),t.push(m)}return t},[$,y,d,o]);s.useEffect(()=>{if(z>0)return f(),()=>{l()}},[z,f,l]),s.useEffect(()=>{W!=null&&(b.current?w.current.onActiveIndexChange(W):b.current=!0)},[W,w]),s.useEffect(()=>ve(t=>{t==="hidden"?l():f()}),[f,l]),s.useEffect(()=>{h(L)},[o,E,f,L,l,h]),Se(()=>ye(()=>h(L))),s.useEffect(()=>{const t=R.current;if(!t||j===!1)return;const i=new xe;let m=0,v=0,g=0,N=!1;const ee=D=>{i.start(D),m=Date.now(),N=!1},te=D=>{i.move(D);const{vertical:B,stopPropagation:P,loop:S}=w.current,x=i.touchData;if(N)v=i.isVertical()?i.touchData.deltaY:i.touchData.deltaX,r(g+v,{critical:S});else{const q=B?"vertical":"horizontal";x.direction===q&&(C(),l(),L(),N=!0,g=T.current.wrapperOffset||0)}N&&x.offsetY>x.offsetX===B&&ge(D,P)},we=()=>{const D=Date.now()-m,B=v/D,{activeIndex:P=0,swipeSize:S,swipeLength:x}=T.current,{loop:A}=w.current,q=Math.abs(B)>.25;if(!((q||Math.abs(v)>S/2)&&S>0&&x>1)){r(-P*S,{swiping:!0});return}if(q){A?v<0?p():u():v<0&&P<x-1?p():v>0&&P>0?u():r(-P*S,{swiping:!0});return}if(g=g+v,g>0)e(A?x-1:0),r(A?S:0,{swiping:!0,critical:A});else if(-g>S*(x-1))e(A?0:x-1),r(-S*(A?x:x-1),{swiping:!0,critical:A});else{const se=Math.ceil(-g/S);e(se),r(-se-S,{swiping:!0,critical:A})}},V=()=>{N&&(we(),N=!1,f())};return K(t,"touchstart",ee,{passive:!0}),K(t,"touchmove",te,{passive:!1}),K(t,"touchend",V,{passive:!0}),K(t,"touchcancel",V,{passive:!0}),()=>{t.removeEventListener("touchstart",ee),t.removeEventListener("touchmove",te),t.removeEventListener("touchend",V),t.removeEventListener("touchcancel",V)}},[r,p,u,w,L,e,Z,f,T,l,C,j]);const pe=()=>{const t={};return t.transform="translate".concat(y?"Y":"X","(").concat(U,"px)"),d>0&&(t[y?"height":"width"]="".concat(d*o,"px")),a&&(t.transitionDuration="".concat(Q,"ms")),t},fe=()=>{if(!(k===!1||o<=0))return k==null||k===!0?H.jsx("div",{className:G("indicators"),children:new Array(o).fill(0).map((t,i)=>H.jsx("i",{className:G("indicator",{active:i===(W||0)})},i))}):k};return H.jsxs("div",{ref:_,className:re(G({vertical:y}),n),...X,children:[H.jsx("div",{className:G("wrapper"),style:pe(),ref:R,children:Y.map((t,i)=>{if(s.isValidElement(t)){const m=t.props.style,v=t.key;let g={...le[i]};return typeof m=="object"&&(g={...g,...m}),ne.cloneElement(t,{...t.props,style:g,key:v!=null?v:i})}return t})}),fe()]})});oe.displayName="Swipe";const Oe=oe,$e="fnx-swipe-item",ke=ce($e),ae=s.forwardRef(({className:c,children:O,...I},n)=>H.jsx("div",{className:re(ke(),c),...I,ref:n,children:O}));ae.displayName="SwipeItem";const Re=ae,ue=Oe;ue.Item=Re;const Ke=ue;export{Ke as S,Ee as u};
