import{r,j as s,c as F,a as M}from"./index-8b435b75.js";import{c as C}from"./config-component-props-c0788442.js";import{u as U}from"./use-update-effect-311108d7.js";import{I as b}from"./index-f0ac2a00.js";import{a as w}from"./format-3509efe4.js";import{n as I}from"./misc-276e45ca.js";import{u as _}from"./use-merged-prop-ref-bd8415d7.js";import{I as E}from"./detect-9e279ab2.js";function $(t){if(!t)return;const i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=t.getBoundingClientRect();if(o){const{top:e,bottom:c,left:l,right:u}=o;return c>0&&e<=a&&l<=i&&u>0}return!1}function G(t){const[i,a]=r.useState(()=>!E||!window.IntersectionObserver?!0:$(t==null?void 0:t.current));return r.useEffect(()=>{const o=t==null?void 0:t.current;if(!o||!E||!window.IntersectionObserver)return;const e=new IntersectionObserver(c=>{c.some(l=>l.intersectionRatio>0?(a(!0),e.disconnect(),!0):!1)},{threshold:[1e-4]});return e.observe(o),()=>{e.disconnect()}},[t]),i}const j=t=>{const i=G(t.nodeRef),a=_(I,t.onActive);return r.useEffect(()=>{i&&a.current()},[i,a]),s.jsx(s.Fragment,{})};j.displayName="LazyDetector";const k=j,q="fnx-image",d=M(q),J=C({fit:"fill",radius:0,slots:{},onLoad:I,onError:I,lazy:!1}),K=s.jsx(b,{name:"photo"}),Q=s.jsx(b,{name:"photo-fail"}),N=r.forwardRef((t,i)=>{const[{fit:a,radius:o,slots:e,onLoad:c,onError:l,lazy:u},{src:P,width:m,position:S,height:f,alt:L,round:z,className:O,style:R,children:H,...V}]=J(t),p=r.useRef(null),[W,y]=r.useState(!1),[h,v]=r.useState(!1),[x,A]=r.useState(!u),g=x?P:void 0;r.useImperativeHandle(i,()=>p.current),U(()=>{y(!1),v(!1)},[g]);const D=r.useMemo(()=>{const n={};return m!=null&&(n.width=w(m)),f!=null&&(n.height=w(f)),o&&(n.overflow="hidden",n.borderRadius=w(o)),n},[m,f,o]),B=()=>{if(!h&&!W&&e.loading!==!1)return s.jsx("span",{className:d("loading"),children:e.loading||K});if(h&&e.error!==!1)return s.jsx("span",{className:d("error"),children:e.error||Q})};return s.jsxs("span",{className:F([d({round:z})],O),style:{...D,...R},...V,ref:p,children:[u&&!x&&s.jsx(k,{nodeRef:p,onActive:()=>A(!0)}),!h&&g&&s.jsx("img",{className:d("img"),src:g,alt:L,style:{objectFit:a,objectPosition:S},onLoad:n=>{y(!0),c(n)},onError:n=>{v(!0),l(n)}}),B(),H]})});N.displayName="Image";const nt=N;export{nt as I};
